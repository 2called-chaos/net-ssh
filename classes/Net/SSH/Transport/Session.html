<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Net::SSH::Transport::Session</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Net::SSH::Transport::Session
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../../files/lib/net/ssh/transport/session_rb.html">lib/net/ssh/transport/session.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Transport.html">Transport</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The transport layer represents the lowest level of the <a
            href="../../SSH.html">SSH</a> protocol, and implements basic message
            exchanging and protocol initialization. It will never be instantiated
            directly (unless you really know what you're about), but will instead be
            created for you automatically when you create a <a
            href="Session.html#method-c-new">::new</a> <a href="../../SSH.html">SSH</a>
            session via <a href="../../SSH.html#method-c-start">Net::SSH.start</a>.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#attribute-i-algorithms">algorithms</a></li>
              <li><a target="docwin" href="#method-i-close">close</a></li>
              <li><a target="docwin" href="#method-i-closed-3F">closed?</a></li>
              <li><a target="docwin" href="#method-i-configure_client">configure_client</a></li>
              <li><a target="docwin" href="#method-i-configure_server">configure_server</a></li>
              <li><a target="docwin" href="#method-i-enqueue_message">enqueue_message</a></li>
              <li><a target="docwin" href="#method-i-hint">hint</a></li>
              <li><a target="docwin" href="#attribute-i-host">host</a></li>
              <li><a target="docwin" href="#method-i-host_as_string">host_as_string</a></li>
              <li><a target="docwin" href="#attribute-i-host_key_verifier">host_key_verifier</a></li>
              <li><a target="docwin" href="#method-i-next_message">next_message</a></li>
              <li><a target="docwin" href="#attribute-i-options">options</a></li>
              <li><a target="docwin" href="#method-i-peer">peer</a></li>
              <li><a target="docwin" href="#method-i-poll_message">poll_message</a></li>
              <li><a target="docwin" href="#attribute-i-port">port</a></li>
              <li><a target="docwin" href="#method-i-push">push</a></li>
              <li><a target="docwin" href="#method-i-rekey-21">rekey!</a></li>
              <li><a target="docwin" href="#method-i-rekey_as_needed">rekey_as_needed</a></li>
              <li><a target="docwin" href="#method-i-send_message">send_message</a></li>
              <li><a target="docwin" href="#attribute-i-server_version">server_version</a></li>
              <li><a target="docwin" href="#method-i-service_request">service_request</a></li>
              <li><a target="docwin" href="#method-i-shutdown-21">shutdown!</a></li>
              <li><a target="docwin" href="#attribute-i-socket">socket</a></li>
              <li><a target="docwin" href="#method-i-wait">wait</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a target="docwin" href="Constants.html">Constants</a></li>
                <li><a target="docwin" href="../Loggable.html">Loggable</a></li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_PORT</td>
                    <td>=</td>
                    <td class='context-item-value'>22</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>The standard <a href="Session.html#attribute-i-port">#port</a> for the <a
                      href="../../SSH.html">SSH</a> protocol.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-algorithms'>algorithms</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="Algorithms.html">Algorithms</a> instance used to perform key
                      exchanges.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-host'>host</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="Session.html#attribute-i-host">#host</a> to connect to, as
                      given to the constructor.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-host_key_verifier'>host_key_verifier</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="Session.html#attribute-i-host">#host</a>-key verifier object
                      used to verify <a href="Session.html#attribute-i-host">#host</a> keys, to
                      ensure that the connection is not being spoofed.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-options'>options</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The hash of <a href="Session.html#attribute-i-options">#options</a> that
                      were given to the object at initialization.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-port'>port</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="Session.html#attribute-i-port">#port</a> number to connect to,
                      as given in the <a href="Session.html#attribute-i-options">#options</a> to
                      the constructor. If no <a href="Session.html#attribute-i-port">#port</a>
                      number was given, this will default to <a
                      href="Session.html#DEFAULT_PORT">DEFAULT_PORT</a>.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-server_version'>server_version</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="ServerVersion.html">ServerVersion</a> instance that
                      encapsulates the negotiated protocol version.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-socket'>socket</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The underlying <a href="Session.html#attribute-i-socket">#socket</a> object
                      being used to communicate with the remote <a
                      href="Session.html#attribute-i-host">#host</a>.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(host, options={})</span>
                </div>
                <div class='description'>
                  
                  <p>Instantiates a <a href="Session.html#method-c-new">::new</a> transport
                  layer abstraction. This will block until the initial key exchange
                  completes, leaving you with a ready-to-use transport session.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 57</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">options</span>={})&#x000A;  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:logger</span>]&#x000A;&#x000A;  <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>&#x000A;  <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;  <span class="ruby-ivar">@bind_address</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:bind_address</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">nil</span>&#x000A;  <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>&#x000A;&#x000A;  <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;establishing connection to #{@host}:#{@port}&quot;</span> }&#x000A;  <span class="ruby-identifier">factory</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:proxy</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">TCPSocket</span>&#x000A;  <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) { <span class="ruby-ivar">@bind_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:proxy</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-ivar">@port</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@host</span>,<span class="ruby-ivar">@port</span>,<span class="ruby-ivar">@bind_address</span>) }&#x000A;  <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">PacketStream</span>)&#x000A;  <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-ivar">@logger</span>&#x000A;&#x000A;  <span class="ruby-identifier">debug</span> { <span class="ruby-string">&quot;connection established&quot;</span> }&#x000A;&#x000A;  <span class="ruby-ivar">@queue</span> = []&#x000A;&#x000A;  <span class="ruby-ivar">@host_key_verifier</span> = <span class="ruby-identifier">select_host_key_verifier</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:paranoid</span>])&#x000A;&#x000A;&#x000A;  <span class="ruby-ivar">@server_version</span> = <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) { <span class="ruby-constant">ServerVersion</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">logger</span>) }&#x000A;&#x000A;  <span class="ruby-ivar">@algorithms</span> = <span class="ruby-constant">Algorithms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">options</span>)&#x000A;  <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-close'>
                <a name='method-i-close'></a>
                <div class='synopsis'>
                  <span class='name'>close</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Cleans up (see <a
                  href="PacketStream.html#method-i-cleanup">Net::SSH::Transport::PacketStream#cleanup</a>)
                  and closes the underlying <a
                  href="Session.html#attribute-i-socket">#socket</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-close-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-close-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 105</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">close</span>&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">cleanup</span>&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-closed-3F'>
                <a name='method-i-closed-3F'></a>
                <div class='synopsis'>
                  <span class='name'>closed?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns true if the underlying <a
                  href="Session.html#attribute-i-socket">#socket</a> has been closed.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-closed-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-closed-3F-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 100</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">closed?</span>&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">closed?</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-configure_client'>
                <a name='method-i-configure_client'></a>
                <div class='synopsis'>
                  <span class='name'>configure_client</span>
                  <span class='arguments'>(options={})</span>
                </div>
                <div class='description'>
                  
                  <p>Configure's the packet stream's client state with the given set of <a
                  href="Session.html#attribute-i-options">#options</a>. This is typically
                  used to define the cipher, compression, and hmac <a
                  href="Session.html#attribute-i-algorithms">#algorithms</a> to use when
                  sending packets to the server.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-configure_client-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-configure_client-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 232</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">configure_client</span>(<span class="ruby-identifier">options</span>={})&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-configure_server'>
                <a name='method-i-configure_server'></a>
                <div class='synopsis'>
                  <span class='name'>configure_server</span>
                  <span class='arguments'>(options={})</span>
                </div>
                <div class='description'>
                  
                  <p>Configure's the packet stream's server state with the given set of <a
                  href="Session.html#attribute-i-options">#options</a>. This is typically
                  used to define the cipher, compression, and hmac <a
                  href="Session.html#attribute-i-algorithms">#algorithms</a> to use when
                  reading packets from the server.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-configure_server-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-configure_server-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 239</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">configure_server</span>(<span class="ruby-identifier">options</span>={})&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">server</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-enqueue_message'>
                <a name='method-i-enqueue_message'></a>
                <div class='synopsis'>
                  <span class='name'>enqueue_message</span>
                  <span class='arguments'>(message)</span>
                </div>
                <div class='description'>
                  
                  <p>Enqueues the given message, such that it will be sent at the earliest
                  opportunity. This does not block, but returns immediately.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-enqueue_message-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-enqueue_message-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 225</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">enqueue_message</span>(<span class="ruby-identifier">message</span>)&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">enqueue_packet</span>(<span class="ruby-identifier">message</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-hint'>
                <a name='method-i-hint'></a>
                <div class='synopsis'>
                  <span class='name'>hint</span>
                  <span class='arguments'>(which, value=true)</span>
                </div>
                <div class='description'>
                  
                  <p>Sets a <a href="Session.html#method-c-new">::new</a> <a
                  href="Session.html#method-i-hint">#hint</a> for the packet stream, which
                  the packet stream may use to change its behavior. (See <a
                  href="PacketStream.html#attribute-i-hints">Net::SSH::Transport::PacketStream#hints</a>).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-hint-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-hint-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 245</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">hint</span>(<span class="ruby-identifier">which</span>, <span class="ruby-identifier">value</span>=<span class="ruby-keyword">true</span>)&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">hints</span>[<span class="ruby-identifier">which</span>] = <span class="ruby-identifier">value</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-host_as_string'>
                <a name='method-i-host_as_string'></a>
                <div class='synopsis'>
                  <span class='name'>host_as_string</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns the <a href="Session.html#attribute-i-host">#host</a> (and possibly
                  IP address) in a format compatible with <a href="../../SSH.html">SSH</a>
                  known-<a href="Session.html#attribute-i-host">#host</a> files.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-host_as_string-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-host_as_string-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 86</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">host_as_string</span>&#x000A;  <span class="ruby-ivar">@host_as_string</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>&#x000A;    <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;#{host}&quot;</span>&#x000A;    <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;[#{string}]:#{port}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">host</span>&#x000A;      <span class="ruby-identifier">string2</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>&#x000A;      <span class="ruby-identifier">string2</span> = <span class="ruby-node">&quot;[#{string2}]:#{port}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;      <span class="ruby-identifier">string</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;,&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">string2</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">string</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-next_message'>
                <a name='method-i-next_message'></a>
                <div class='synopsis'>
                  <span class='name'>next_message</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Blocks until a <a href="Session.html#method-c-new">::new</a> packet is
                  available to be read, and returns that packet. See #<a
                  href="Session.html#method-i-poll_message">#poll_message</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-next_message-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-next_message-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 151</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_message</span>&#x000A;  <span class="ruby-identifier">poll_message</span>(<span class="ruby-value">:block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-peer'>
                <a name='method-i-peer'></a>
                <div class='synopsis'>
                  <span class='name'>peer</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns a hash of information about the <a
                  href="Session.html#method-i-peer">#peer</a> (remote) side of the <a
                  href="Session.html#attribute-i-socket">#socket</a>, including :ip, :<a
                  href="Session.html#attribute-i-port">#port</a>, :<a
                  href="Session.html#attribute-i-host">#host</a>, and :canonized (see #<a
                  href="Session.html#method-i-host_as_string">#host_as_string</a>).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-peer-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-peer-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 145</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer</span>&#x000A;  <span class="ruby-ivar">@peer</span> <span class="ruby-operator">||=</span> { <span class="ruby-value">:ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>, <span class="ruby-value">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@port</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@host</span>, <span class="ruby-value">:canonized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">host_as_string</span> }&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-poll_message'>
                <a name='method-i-poll_message'></a>
                <div class='synopsis'>
                  <span class='name'>poll_message</span>
                  <span class='arguments'>(mode=:nonblock, consume_queue=true)</span>
                </div>
                <div class='description'>
                  
                  <p>Tries to read the next packet from the <a
                  href="Session.html#attribute-i-socket">#socket</a>. If mode is :nonblock
                  (the default), this will not block and will return nil if there are no
                  packets waiting to be read. Otherwise, this will block until a packet is
                  available. Note that some packet types (DISCONNECT, IGNORE, UNIMPLEMENTED,
                  DEBUG, and KEXINIT) are handled silently by this method, and will never be
                  returned.</p>
                  
                  <p>If a key-exchange is in process and a disallowed packet type is received,
                  it will be enqueued and otherwise ignored. When a key-exchange is not in
                  process, and consume_queue is true, packets will be first read from the
                  queue before the <a href="Session.html#attribute-i-socket">#socket</a> is
                  queried.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-poll_message-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-poll_message-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 166</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">mode</span>=<span class="ruby-value">:nonblock</span>, <span class="ruby-identifier">consume_queue</span>=<span class="ruby-keyword">true</span>)&#x000A;  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">consume_queue</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">first</span>)&#x000A;      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">shift</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;&#x000A;    <span class="ruby-identifier">packet</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">next_packet</span>(<span class="ruby-identifier">mode</span>)&#x000A;    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">nil?</span>&#x000A;&#x000A;    <span class="ruby-keyword">case</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">DISCONNECT</span>&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Disconnect</span>, <span class="ruby-node">&quot;disconnected: #{packet[:description]} (#{packet[:reason_code]})&quot;</span>&#x000A;&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">IGNORE</span>&#x000A;      <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;IGNORE packet recieved: #{packet[:data].inspect}&quot;</span> }&#x000A;&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">UNIMPLEMENTED</span>&#x000A;      <span class="ruby-identifier">lwarn</span> { <span class="ruby-node">&quot;UNIMPLEMENTED: #{packet[:number]}&quot;</span> }&#x000A;&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">DEBUG</span>&#x000A;      <span class="ruby-identifier">send</span>(<span class="ruby-identifier">packet</span>[<span class="ruby-value">:always_display</span>] <span class="ruby-operator">?</span> <span class="ruby-value">:fatal</span> <span class="ruby-operator">:</span> <span class="ruby-value">:debug</span>) { <span class="ruby-identifier">packet</span>[<span class="ruby-value">:message</span>] }&#x000A;&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">KEXINIT</span>&#x000A;      <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">accept_kexinit</span>(<span class="ruby-identifier">packet</span>)&#x000A;&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-keyword">return</span> <span class="ruby-identifier">packet</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-identifier">packet</span>)&#x000A;      <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-push'>
                <a name='method-i-push'></a>
                <div class='synopsis'>
                  <span class='name'>push</span>
                  <span class='arguments'>(packet)</span>
                </div>
                <div class='description'>
                  
                  <p>Adds the given packet to the packet queue. If the queue is non-empty, #<a
                  href="Session.html#method-i-poll_message">#poll_message</a> will return
                  packets from the queue in the order they were received.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-push-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-push-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 213</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;  <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-rekey-21'>
                <a name='method-i-rekey-21'></a>
                <div class='synopsis'>
                  <span class='name'>rekey!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Requests a rekey operation, and blocks until the operation completes. If a
                  rekey is already pending, this returns immediately, having no effect.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-rekey-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-rekey-21-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 128</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">rekey!</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>&#x000A;    <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">rekey!</span>&#x000A;    <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-rekey_as_needed'>
                <a name='method-i-rekey_as_needed'></a>
                <div class='synopsis'>
                  <span class='name'>rekey_as_needed</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns immediately if a rekey is already in process. Otherwise, if a rekey
                  is needed (as indicated by the <a
                  href="Session.html#attribute-i-socket">#socket</a>, see <a
                  href="PacketStream.html#method-i-if_needs_rekey-3F">Net::SSH::Transport::PacketStream#if_needs_rekey?</a>)
                  one is performed, causing this method to block until it completes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-rekey_as_needed-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-rekey_as_needed-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 138</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">rekey_as_needed</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">if_needs_rekey?</span> { <span class="ruby-identifier">rekey!</span> }&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-send_message'>
                <a name='method-i-send_message'></a>
                <div class='synopsis'>
                  <span class='name'>send_message</span>
                  <span class='arguments'>(message)</span>
                </div>
                <div class='description'>
                  
                  <p>Sends the given message via the packet stream, blocking until the entire
                  message has been sent.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-send_message-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-send_message-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 219</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_message</span>(<span class="ruby-identifier">message</span>)&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send_packet</span>(<span class="ruby-identifier">message</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-service_request'>
                <a name='method-i-service_request'></a>
                <div class='synopsis'>
                  <span class='name'>service_request</span>
                  <span class='arguments'>(service)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns a <a href="Session.html#method-c-new">::new</a> <a
                  href="Session.html#method-i-service_request">#service_request</a> packet
                  for the given service name, ready for sending to the server.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-service_request-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-service_request-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 121</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">service_request</span>(<span class="ruby-identifier">service</span>)&#x000A;  <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:byte</span>, <span class="ruby-constant">SERVICE_REQUEST</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">service</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-shutdown-21'>
                <a name='method-i-shutdown-21'></a>
                <div class='synopsis'>
                  <span class='name'>shutdown!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Performs a "hard" shutdown of the connection. In general, this should never
                  be done, but it might be necessary (in a rescue clause, for instance, when
                  the connection needs to <a href="Session.html#method-i-close">#close</a>
                  but you don't know the status of the underlying protocol's state).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-shutdown-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-shutdown-21-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 114</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">shutdown!</span>&#x000A;  <span class="ruby-identifier">error</span> { <span class="ruby-string">&quot;forcing connection closed&quot;</span> }&#x000A;  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-wait'>
                <a name='method-i-wait'></a>
                <div class='synopsis'>
                  <span class='name'>wait</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Waits (blocks) until the given block returns true. If no block is given,
                  this just waits long enough to see if there are any pending packets. Any
                  packets read are enqueued (see #<a
                  href="Session.html#method-i-push">#push</a>).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-wait-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-wait-source'><span class="ruby-comment"># File lib/net/ssh/transport/session.rb, line 201</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">wait</span>&#x000A;  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">yield</span>&#x000A;    <span class="ruby-identifier">message</span> = <span class="ruby-identifier">poll_message</span>(<span class="ruby-value">:nonblock</span>, <span class="ruby-keyword">false</span>)&#x000A;    <span class="ruby-identifier">push</span>(<span class="ruby-identifier">message</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">message</span>&#x000A;    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
